-- ============================================
-- Rollback Migration: 01_rollback_create_onsen_master
-- Date: 2026-01-02
-- Author: @yurift
-- Description: Rollback for 01_create_onsen_master.sql
-- Original Migration: 01_create_onsen_master.sql
-- ============================================

-- âš ï¸ WARNING: ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™
-- å®Ÿè¡Œå‰ã«å¿…ãšãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—ã—ã¦ãã ã•ã„

-- â–¼â–¼â–¼ Rollback Start â–¼â–¼â–¼

-- ========================================
-- 1. ãƒˆãƒªã‚¬ãƒ¼å‰Šé™¤
-- ========================================

DROP TRIGGER IF EXISTS update_onsen_master_updated_at ON onsen_master;

-- ========================================
-- 2. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‰Šé™¤
-- ========================================

DROP INDEX IF EXISTS idx_onsen_location;
DROP INDEX IF EXISTS idx_onsen_keywords;
DROP INDEX IF EXISTS idx_onsen_price;

-- ========================================
-- 3. ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤
-- ========================================

-- CASCADE: å¤–éƒ¨ã‚­ãƒ¼å‚ç…§ãŒã‚ã£ã¦ã‚‚å¼·åˆ¶å‰Šé™¤
DROP TABLE IF EXISTS onsen_master CASCADE;

-- âš ï¸ onsen_master ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã™

-- ========================================
-- 4. ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°å‰Šé™¤ï¼ˆä»–ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§ä½¿ç”¨ã—ã¦ã„ãªã„å ´åˆã®ã¿ï¼‰
-- ========================================

-- æ³¨æ„: update_updated_at_column() é–¢æ•°ã¯ä»–ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã‚‚ä½¿ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚
-- å‰Šé™¤ã™ã‚‹å ´åˆã¯ä»–ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§ä½¿ç”¨ã—ã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„

-- DROP FUNCTION IF EXISTS update_updated_at_column() CASCADE;

-- â–²â–²â–² Rollback End â–²â–²â–²

-- ============================================
-- Verification (å®Ÿè¡Œå¾Œã®ç¢ºèªç”¨ã‚¯ã‚¨ãƒª)
-- ============================================

-- ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå‰Šé™¤ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªï¼ˆfalse ãŒè¿”ã‚‹ã¯ãšï¼‰
SELECT EXISTS (
    SELECT FROM information_schema.tables
    WHERE table_schema = 'public'
    AND table_name = 'onsen_master'
) as table_exists;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒå‰Šé™¤ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªï¼ˆ0ä»¶ã®ã¯ãšï¼‰
SELECT COUNT(*) as index_count
FROM pg_indexes
WHERE tablename = 'onsen_master';

-- ============================================
-- Rollbackå®Œäº†å¾Œã®æ‰‹é †
-- ============================================
-- 1. data/sql/README.md ã®å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
-- 2. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ "ğŸ”´ Rolled Back" ã«å¤‰æ›´
-- 3. Gitã‚³ãƒŸãƒƒãƒˆ
--    git add data/sql/01_rollback_create_onsen_master.sql
--    git add data/sql/README.md
--    git commit -m "Rollback: onsen_master table"
-- ============================================

-- ============================================
-- Notes
-- ============================================
-- - ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ YURIFT ã®ä¸­æ ¸ãƒ‡ãƒ¼ã‚¿ã§ã™
-- - ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ã¨å…¨ã¦ã®æ¸©æ³‰ãƒ‡ãƒ¼ã‚¿ãŒå¤±ã‚ã‚Œã¾ã™
-- - æœ¬ç•ªç’°å¢ƒã§ã®å®Ÿè¡Œã¯æ¥µã‚ã¦æ…é‡ã«
-- - å¿…ãšäº‹å‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—ã—ã¦ãã ã•ã„
-- ============================================
